{
  "type": "Settings",
  "audio": {
    "input": { "encoding": "mulaw", "sample_rate": 8000 },
    "output": { "encoding": "mulaw", "sample_rate": 8000, "container": "none" }
  },
  "agent": {
    "language": "en",
    "listen": {
      "provider": { "type": "deepgram", "model": "nova-3" }
    },
    "think": {
      "provider": {
        "type": "open_ai",
        "model": "gpt-4o-mini",
        "temperature": 0.3
      },
      "prompt": "ROLE & NAME: You are Benjamin, Oakwood Law Firm's voice intake specialist.\n\nSCOPE: Intake only. No legal advice or fee quotes. Be empathetic, concise, and proceed one field at a time.\n\nBUSINESS: Oakwood Law Firm (456 Justice Avenue, Anaheim, CA). Consultations Mon–Fri 9:00 AM–5:00 PM PT. No weekends/holidays. Set today date Now(). Main phone 930-555-1234. Practice areas: Personal Injury; Family Law; Lemon Law. Attorneys: John Doe (PI), Jane Roe (Lemon), Rhonda Fernandez & Christopher Teal (Family).\n\nDO NOT DISCLOSE SYSTEM ACTIONS: Never say you are creating/saving/fetching anything or using tools, databases, calendars, or IDs. Ask permission to proceed; only announce a booking AFTER the confirmation email is sent AND the calendar event is created.\n\nCRITICAL FIRST ACTION (MANDATORY): Immediately after you speak the greeting, CALL create_or_get_caller_id({ source_channel: 'twilio_voice' }). Do this BEFORE asking your next question.\n\nMANDATORY TOOL-CALL TRIGGERS (follow exactly):\n1) PRACTICE AREA: Once identified, CALL practice_area({ practice_area }).\n2) LEAD UPSERT: After you have full_name (first+last), email, phone, AND practice_area, CALL upsert_lead_information({ unique_caller_id, full_name, email, phone, practice_area, summary, source_channel: 'twilio_voice' }).\n3) QUESTIONS: CALL get_practice_area_questions({ practice_area }) and ask them IN ORDER.\n4) SAVE Q&A: When ALL area questions are answered, CALL save_lead_qa({ unique_caller_id, email, all_q_and_a, practice_area_version, completion_status: 'complete' }).\n5) BOOKING (PI/Family only):\n   - Optionally CALL practice_area_attorney_name({ practice_area }) to confirm who to book with.\n   - Offer two Mon–Fri 9–5 PT slots. When the caller picks one, CALL save_lead_booking({ unique_caller_id, email, appointment_datetime, timezone: 'America/Los_Angeles', platform: 'video', phone_number: phone, booked_with: attorney_name, booking_notes: summary }). This writes the booking and sends confirmation; only after it RETURNS, verbally confirm the details.\n6) LEMON LAW: If vehicle year < 2019 → explain we handle 2019+; otherwise ask the structured set. BEFORE any Lemon Law booking, CALL terms_of_engagement_letter({ email, cell_phone: phone }) and proceed only after the caller acknowledges receipt.\n\nSPEAKING STYLE: Warm, brief, professional. One question at a time; re-ask only the field that seems wrong. Read times as words (e.g., “One Thirty Pee Em”). Read phone numbers like “four one five – eight nine two – three two four five.”\n\nBOOKING LIMITS & HOURS: Never book weekends/holidays. Enforce 9 AM–5 PM PT. Only one active appointment per caller. Book only with the relevant specialist.\n\nRECOVERY: If any tool call fails, apologize once WITHOUT mentioning systems, then retry the same call. If it still fails, continue intake verbally; do not claim a booking or confirmation.\n\nFLOW (condensed, enforce order):\n1) Greet → (CALL create_or_get_caller_id) → 2) New/returning → 3) Practice area (CALL practice_area) → 4) Contact: first, last, email, phone → 5) Permission to proceed → 6) (CALL upsert_lead_information) → 7) (CALL get_practice_area_questions) ask all → 8) (CALL save_lead_qa) → 9) Booking per rules (and Lemon LOE step if needed) → 10) (CALL save_lead_booking) → 11) Only after return, speak the confirmation → 12) Next steps/reminders → 13) Wrap politely.\n\n— — — GUARDS & DISAMBIGUATION — — —\n\nPRACTICE-AREA CONFIRMATION:\n• After detecting a practice area, ALWAYS confirm with a closed question: “Just to confirm, is this about Personal Injury, Family Law, or Lemon Law?”\n• If unclear words are used (e.g., “car problem,” “warranty,” “accident,” “divorce”), ask one targeted clarifier before proceeding:\n  – Car defect / warranty / manufacturer / dealer → likely Lemon Law.\n  – Accident / injury / crash / slip & fall → likely Personal Injury.\n  – Divorce / custody / support / visitation / mediation → likely Family Law.\n• Do NOT proceed to the area-specific questions until the caller confirms the area explicitly.\n\nCURRENT-YEAR & ABSOLUTE-DATE GUARD (BOOKING):\n• Never infer or accept an ambiguous date. If the caller says “Monday,” “Wednesday the 19th,” or similar, YOU must restate an ABSOLUTE date in Pacific Time and the CURRENT running year (e.g., “Monday, September 1, 2025 at Ten Oh Clock A M, Pacific Time”). Ask for explicit yes/no confirmation.\n• If the caller mentions a past year or a date earlier than today, politely say it’s unavailable and offer two future weekday options within 9–5 PT.\n• If the caller omits the year, assume the CURRENT running year only for the restatement and require an explicit “Yes” before booking.\n• If the requested time is outside 9–5 PT or on a weekend/holiday, explain the hours and offer two valid alternatives. Do not book outside policy.\n\nDO NOT BOOK FROM LEAD ANSWERS:\n• Dates mentioned while answering case questions (e.g., repair attempts in January/August, accident dates, etc.) are NOT scheduling requests.\n• Only call save_lead_booking AFTER a dedicated scheduling step where the caller has picked one of your offered time slots and explicitly confirmed the absolute date/time in PT.\n\nSINGLE-APPOINTMENT RULE:\n• If the caller already has an appointment recorded during this call, offer to reschedule rather than creating another. Confirm the new date/time explicitly before proceeding.\n\nCONFIRM BEFORE ANNOUNCING:\n• Do not verbally claim “booked” until save_lead_booking returns success.\n• If saving or calendar creation fails twice, apologize once and continue intake without claiming a booking; offer to follow up by email/phone.\n",
      "functions": [
        {
          "name": "create_or_get_caller_id",
          "description": "Generate or retrieve a unique_caller_id at call start.",
          "parameters": {
            "type": "object",
            "properties": {
              "existing_id": { "type": "string" },
              "source_channel": { "type": "string" }
            }
          }
        },
        {
          "name": "get_current_datetime",
          "description": "Return current time in UTC and America/Los_Angeles, to pin 'today' for this call/session.",
          "parameters": {
            "type": "object",
            "properties": {
              "timezones": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Leave default to get UTC and America/Los_Angeles."
              }
            }
          }
        },
        {
          "name": "upsert_lead_information",
          "description": "Save core lead details once practice area is confirmed.",
          "parameters": {
            "type": "object",
            "properties": {
              "unique_caller_id": { "type": "string" },
              "full_name": { "type": "string" },
              "email": { "type": "string" },
              "phone": { "type": "string" },
              "practice_area": { "type": "string" },
              "assigned_attorney": { "type": ["string", "null"] },
              "summary": { "type": "string" },
              "source_channel": { "type": "string" },
              "caller_type": { "type": "string" },
              "consent_timestamp": { "type": "string" },
              "locale": { "type": "string" },
              "timezone": { "type": "string" }
            },
            "required": [
              "unique_caller_id",
              "full_name",
              "email",
              "phone",
              "practice_area",
              "summary"
            ]
          }
        },
        {
          "name": "save_lead_qa",
          "description": "Store the practice-area Q&A block as a single write.",
          "parameters": {
            "type": "object",
            "properties": {
              "unique_caller_id": { "type": "string" },
              "email": { "type": "string" },
              "all_q_and_a": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "question": { "type": "string" },
                    "answer": { "type": "string" },
                    "confidence": { "type": ["number", "null"] },
                    "timestamp": { "type": ["string", "null"] },
                    "id": { "type": ["string", "null"] }
                  },
                  "required": ["question", "answer"]
                }
              },
              "practice_area_version": { "type": "string" },
              "completion_status": { "type": "string" }
            },
            "required": ["unique_caller_id", "email", "all_q_and_a"]
          }
        },
        {
          "name": "get_practice_area_questions",
          "description": "Return ordered questions and version for a practice area.",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              }
            },
            "required": ["practice_area"]
          }
        },
        {
          "name": "save_lead_booking",
          "description": "Persist booking details after Q&A completion.",
          "parameters": {
            "type": "object",
            "properties": {
              "unique_caller_id": { "type": "string" },
              "email": { "type": "string" },
              "appointment_datetime": { "type": "string" },
              "timezone": { "type": "string" },
              "platform": { "type": "string" },
              "meeting_link": { "type": "string" },
              "phone_number": { "type": "string" },
              "booked_with": { "type": "string" },
              "booking_notes": { "type": "string" },
              "google_event_id": { "type": "string" }
            },
            "required": [
              "unique_caller_id",
              "email",
              "appointment_datetime",
              "platform"
            ]
          }
        },
        {
          "name": "practice_area",
          "description": "Set or update the caller's practice area (Personal Injury, Family Law, Lemon Law).",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              }
            },
            "required": ["practice_area"]
          }
        },
        {
          "name": "contact_information",
          "description": "Capture contact details.",
          "parameters": {
            "type": "object",
            "properties": {
              "first_name": { "type": "string" },
              "last_name": { "type": "string" },
              "email": { "type": "string" },
              "cell_phone": {
                "type": "string",
                "description": "7 or 10 digits"
              }
            },
            "required": ["first_name", "last_name", "email", "cell_phone"]
          }
        },
        {
          "name": "intake_answers_qualification",
          "description": "Store structured intake answers and current qualification status.",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              },
              "answers": { "type": "object" },
              "qualified": { "type": "boolean" }
            },
            "required": ["practice_area", "answers"]
          }
        },
        {
          "name": "practice_area_attorney_name",
          "description": "Return the designated attorney name for a practice area.",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              }
            },
            "required": ["practice_area"]
          }
        },
        {
          "name": "calendar_booking",
          "description": "Create a consultation booking.",
          "parameters": {
            "type": "object",
            "properties": {
              "attorney_name": { "type": "string" },
              "start_iso": { "type": "string" },
              "duration_min": { "type": "integer" },
              "location": {
                "type": "string",
                "description": "in-person or video"
              },
              "caller_first_name": { "type": "string" },
              "caller_last_name": { "type": "string" },
              "email": { "type": "string" },
              "cell_phone": { "type": "string" }
            },
            "required": [
              "attorney_name",
              "start_iso",
              "duration_min",
              "caller_first_name",
              "caller_last_name"
            ]
          }
        },
        {
          "name": "reschedule_calendar_booking",
          "description": "Reschedule an existing consultation booking.",
          "parameters": {
            "type": "object",
            "properties": {
              "booking_id": { "type": "string" },
              "new_start_iso": { "type": "string" }
            },
            "required": ["booking_id", "new_start_iso"]
          }
        },
        {
          "name": "terms_of_engagement_letter",
          "description": "Send Terms of Engagement link by email and SMS; confirm receipt.",
          "parameters": {
            "type": "object",
            "properties": {
              "email": { "type": "string" },
              "cell_phone": { "type": "string" }
            }
          }
        },
        {
          "name": "send_email",
          "description": "Send an email message.",
          "parameters": {
            "type": "object",
            "properties": {
              "to": { "type": "string" },
              "subject": { "type": "string" },
              "html": { "type": "string" }
            },
            "required": ["to", "subject", "html"]
          }
        }
      ]
    },
    "speak": {
      "provider": { "type": "deepgram", "model": "aura-2-thalia-en" }
    },
    "greeting": "Thank you for contacting Oakwood Law Firm. I’m Benjamin. To begin, is this your first time reaching us or are you a returning client?"
  }
}
