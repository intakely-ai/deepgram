{
  "type": "Settings",
  "audio": {
    "input": { "encoding": "mulaw", "sample_rate": 8000 },
    "output": { "encoding": "mulaw", "sample_rate": 8000, "container": "none" }
  },
  "agent": {
    "language": "en",
    "listen": {
      "provider": { "type": "deepgram", "model": "nova-3" }
    },
    "think": {
      "provider": {
        "type": "open_ai",
        "model": "gpt-4o-mini",
        "temperature": 0.3
      },
      "prompt": "ROLE & NAME: You are Benjamin, Oakwood Law Firm's voice intake specialist.\n\nSCOPE: Intake only. No legal advice and no fee quotes. Keep empathy, clarity, and urgency. Proceed one field at a time.\n\nTOOLS & SAVE RULES (STRICT):\n- Immediately call create_or_get_caller_id({ source_channel: 'twilio_voice' or 'web_chat' }) and store unique_caller_id. Reuse the returned UUID for all saves.\n- Collect and confirm full_name, email, phone. Confirm practice_area.\n- Save lead information RIGHT AFTER contact+practice_area: call upsert_lead_information({ unique_caller_id, full_name, email, phone, practice_area, summary, source_channel, caller_type? }). Phone must be included.\n- Fetch questions: call get_practice_area_questions({ practice_area }). Ask them in order, store answers locally.\n- Save QA RIGHT AFTER finishing questions: call save_lead_qa({ unique_caller_id, email, all_q_and_a, practice_area_version, completion_status }).\n- Booking: propose times, confirm one, then call save_lead_booking({ unique_caller_id, email, appointment_datetime, timezone?, platform, meeting_link?/phone_number?, booked_with?, booking_notes? }). Then send the email confirmation.\n- Non-blocking: speak first; then write. If a write fails, apologize once and retry.\n- Always include unique_caller_id in every write.\n\nKeep responses concise and confirm critical items (email, phone, practice_area, final booking).",
      "functions": [
        {
          "name": "create_or_get_caller_id",
          "description": "Generate or retrieve a unique_caller_id at call start.",
          "parameters": {
            "type": "object",
            "properties": {
              "existing_id": { "type": "string" },
              "source_channel": { "type": "string" }
            }
          }
        },
        {
          "name": "upsert_lead_information",
          "description": "Save core lead details once practice area is confirmed.",
          "parameters": {
            "type": "object",
            "properties": {
              "unique_caller_id": { "type": "string" },
              "full_name": { "type": "string" },
              "email": { "type": "string" },
              "phone": { "type": "string" },
              "practice_area": { "type": "string" },
              "assigned_attorney": { "type": ["string", "null"] },
              "summary": { "type": "string" },
              "source_channel": { "type": "string" },
              "caller_type": { "type": "string" },
              "consent_timestamp": { "type": "string" },
              "locale": { "type": "string" },
              "timezone": { "type": "string" }
            },
            "required": [
              "unique_caller_id",
              "full_name",
              "email",
              "phone",
              "practice_area",
              "summary"
            ]
          }
        },
        {
          "name": "save_lead_qa",
          "description": "Store the practice-area Q&A block as a single write.",
          "parameters": {
            "type": "object",
            "properties": {
              "unique_caller_id": { "type": "string" },
              "email": { "type": "string" },
              "all_q_and_a": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "question": { "type": "string" },
                    "answer": { "type": "string" },
                    "confidence": { "type": ["number", "null"] },
                    "timestamp": { "type": ["string", "null"] },
                    "id": { "type": ["string", "null"] }
                  },
                  "required": ["question", "answer"]
                }
              },
              "practice_area_version": { "type": "string" },
              "completion_status": { "type": "string" }
            },
            "required": ["unique_caller_id", "email", "all_q_and_a"]
          }
        },
        {
          "name": "get_practice_area_questions",
          "description": "Return ordered questions and version for a practice area.",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              }
            },
            "required": ["practice_area"]
          }
        },
        {
          "name": "save_lead_booking",
          "description": "Persist booking details after Q&A completion.",
          "parameters": {
            "type": "object",
            "properties": {
              "unique_caller_id": { "type": "string" },
              "email": { "type": "string" },
              "appointment_datetime": { "type": "string" },
              "timezone": { "type": "string" },
              "platform": { "type": "string" },
              "meeting_link": { "type": "string" },
              "phone_number": { "type": "string" },
              "booked_with": { "type": "string" },
              "booking_notes": { "type": "string" }
            },
            "required": [
              "unique_caller_id",
              "email",
              "appointment_datetime",
              "platform"
            ]
          }
        },
        {
          "name": "practice_area",
          "description": "Set or update the caller's practice area (Personal Injury, Family Law, Lemon Law).",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              }
            },
            "required": ["practice_area"]
          }
        },
        {
          "name": "contact_information",
          "description": "Capture contact details.",
          "parameters": {
            "type": "object",
            "properties": {
              "first_name": { "type": "string" },
              "last_name": { "type": "string" },
              "email": { "type": "string" },
              "cell_phone": {
                "type": "string",
                "description": "7 or 10 digits"
              }
            },
            "required": ["first_name", "last_name", "email", "cell_phone"]
          }
        },
        {
          "name": "intake_answers_qualification",
          "description": "Store structured intake answers and current qualification status.",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              },
              "answers": { "type": "object" },
              "qualified": { "type": "boolean" }
            },
            "required": ["practice_area", "answers"]
          }
        },
        {
          "name": "practice_area_attorney_name",
          "description": "Return the designated attorney name for a practice area.",
          "parameters": {
            "type": "object",
            "properties": {
              "practice_area": {
                "type": "string",
                "enum": ["personal_injury", "family_law", "lemon_law"]
              }
            },
            "required": ["practice_area"]
          }
        },
        {
          "name": "calendar_booking",
          "description": "Create a consultation booking.",
          "parameters": {
            "type": "object",
            "properties": {
              "attorney_name": { "type": "string" },
              "start_iso": { "type": "string" },
              "duration_min": { "type": "integer" },
              "location": {
                "type": "string",
                "description": "in-person or video"
              },
              "caller_first_name": { "type": "string" },
              "caller_last_name": { "type": "string" },
              "email": { "type": "string" },
              "cell_phone": { "type": "string" }
            },
            "required": [
              "attorney_name",
              "start_iso",
              "duration_min",
              "caller_first_name",
              "caller_last_name"
            ]
          }
        },
        {
          "name": "reschedule_calendar_booking",
          "description": "Reschedule an existing consultation booking.",
          "parameters": {
            "type": "object",
            "properties": {
              "booking_id": { "type": "string" },
              "new_start_iso": { "type": "string" }
            },
            "required": ["booking_id", "new_start_iso"]
          }
        },
        {
          "name": "terms_of_engagement_letter",
          "description": "Send Terms of Engagement link by email and SMS; confirm receipt.",
          "parameters": {
            "type": "object",
            "properties": {
              "email": { "type": "string" },
              "cell_phone": { "type": "string" }
            }
          }
        },
        {
          "name": "send_email",
          "description": "Send an email message.",
          "parameters": {
            "type": "object",
            "properties": {
              "to": { "type": "string" },
              "subject": { "type": "string" },
              "html": { "type": "string" }
            },
            "required": ["to", "subject", "html"]
          }
        }
      ]
    },
    "speak": {
      "provider": { "type": "deepgram", "model": "aura-2-thalia-en" }
    },
    "greeting": "Thank you for contacting Oakwood Law Firm. I’m Benjamin. To begin, is this your first time reaching us or are you a returning client?"
  }
}
